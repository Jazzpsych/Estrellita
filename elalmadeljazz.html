
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>El Alma del Jazz</title>
<style>
        /* CSS completo de "El Alma del Jazz" */
        body {
            font-family: 'Georgia', serif;
            background-color: #1e1e1e;
            color: #f0e6d2;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
	#borrarChatBtn {
   		background-color: #c0392b; /* Rojo oscuro de advertencia */
   		color: white;
  		padding: 10px 15px;
  		border: none;
   		cursor: pointer;
   		border-radius: 6px;
   		width: auto;
   		font-family: 'Georgia', serif; /* Misma fuente que otros botones */
   		font-size: 16px;
   		transition: background-color 0.3s ease;
	}
	#borrarChatBtn:hover {
    		background-color: #a93226; /* Rojo m√°s oscuro al pasar el rat√≥n */
	}


        h1 {
            text-align: center;
            color: #d4af37;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        h2 {
            color: #d4af37;
            font-size: 1.8em;
            margin-top: 30px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #2b2b2b;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        p { font-size: 1.1em; margin: 15px 0; }
        .figure { display: flex; align-items: center; margin: 20px 0; }
        .figure img { width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-right: 20px; border: 2px solid #d4af37; }
        .figure-text { flex: 1; }
        ul { list-style-type: none; padding: 0; }
        li { margin: 10px 0; font-style: italic; }
        a.song-link { color: #87ceeb; text-decoration: none; }
        a.song-link:hover { color: #b0e0e6; text-decoration: underline; }
        a.secret-link { color: #f0e6d2; text-decoration: none; }
        a.secret-link:hover { color: #87ceeb; text-decoration: underline; }
        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            .container { padding: 15px; }
            p, li { font-size: 1em; }
            .figure { flex-direction: column; text-align: center; }
            .figure img { margin: 0 0 10px 0; width: 120px; height: 120px; }
        }

        /* Estilos para el chat p√∫blico */
        .chat-container { display: flex; flex-direction: column; align-items: center; width: 100%; }
        #chat-publico { overflow-y: auto; height: 200px; padding: 10px; width: 100%; box-sizing: border-box; background-color: #3a3a3a; border-radius: 5px; margin-bottom: 10px; }
        .input-container { display: flex; justify-content: center; align-items: center; width: 100%; margin-top: 5px; }
        #mensajeInputPublico { width: 70%; resize: none; /* Cambiado a none */ height: 40px; /* Altura fija */ background-color: #f0e6d2; color: #1e1e1e; padding: 5px; border-radius: 5px; border: 1px solid #555; }
        #enviarMensajePublico { padding: 8px 12px; /* Ajuste de padding */ margin-left: 5px; background-color: #d4af37; color: #1e1e1e; border: none; cursor: pointer; border-radius: 5px; height: 40px; }
        .mensaje-item { text-align: left; margin: 8px 0; padding: 8px 12px; background-color: #4f4f4f; border-radius: 8px; word-wrap: break-word; }
        .mensaje-item p { margin: 0; font-size: 1em; } /* Ajuste tama√±o y margen */
        .mensaje-item strong { color: #d4af37; } /* Nombre de usuario destacado */


        /* Estilos para la secci√≥n secreta (adaptados de Estrellita) */
        #seccion-secreta {
          display: none;
          background-color: #181825; /* Fondo principal oscuro */
          color: #eaeaea; /* Texto general claro */
          padding: 20px;
          border-radius: 10px;
          margin-top: 20px;
          border: 1px solid #333; /* Borde sutil */
        }

        #loginContainer,
        #contenido-secreto {
          background-color: #1e1e2f; /* Fondo de contenedores internos */
          padding: 25px; /* M√°s padding */
          border-radius: 10px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* Sombra m√°s pronunciada */
          margin-bottom: 20px; /* Espacio entre contenedores */
        }

        #loginContainer h2, #contenido-secreto h2 {
          color: #d18fff; /* Color violeta para t√≠tulos */
          text-align: center;
          margin-bottom: 20px;
        }

        /* Estilos consistentes para inputs, selects, textareas, botones */
        select, button, input[type="email"], input[type="password"], input[type="text"], textarea {
          background-color: #2c2c3d; /* Fondo oscuro para inputs */
          color: #f0f0f0; /* Texto claro */
          border: 1px solid #555; /* Borde gris√°ceo */
          padding: 10px 12px; /* Padding uniforme */
          margin: 8px 0; /* Margen vertical */
          border-radius: 6px;
          font-size: 16px; /* Tama√±o de fuente legible */
          width: 100%; /* Ocupar ancho disponible */
          box-sizing: border-box; /* Incluir padding y borde en el ancho */
          font-family: 'Georgia', serif; /* Consistencia de fuente */
        }
        textarea {
          resize: vertical; /* Permitir redimensionar verticalmente */
          min-height: 60px; /* Altura m√≠nima */
        }

        /* Contenedor de contrase√±a */
        .password-container {
          position: relative;
          display: flex;
          align-items: center;
          width: 100%;
        }
        #password {
          flex-grow: 1; /* Input ocupa espacio disponible */
          margin-right: 0; /* Sin margen derecho */
          border-top-right-radius: 0;
          border-bottom-right-radius: 0;
          border-right: none; /* Quitar borde derecho */
        }
        #togglePassword {
          padding: 10px 12px;
          margin: 8px 0 8px -1px; /* Ajuste margen para alinear con input */
          border: 1px solid #555;
          border-left: none;
          border-top-left-radius: 0;
          border-bottom-left-radius: 0;
          cursor: pointer;
          background-color: #2c2c3d; /* Mismo fondo que input */
          color: #f0f0f0;
          width: auto; /* Ancho autom√°tico */
          box-sizing: border-box;
        }

        /* Mensajes y Poemas */
        #mensaje,
        #poema {
          font-size: 1.1em; /* Tama√±o ligeramente mayor */
          margin-top: 15px;
          color: #c8a2c8; /* Lila suave para mensajes */
          background-color: #2a2a3a; /* Fondo sutil */
          padding: 10px;
          border-radius: 5px;
          border-left: 3px solid #d18fff; /* Borde izquierdo destacado */
        }
        #poema {
          font-style: italic;
          white-space: pre-wrap; /* Conservar saltos de l√≠nea */
          color: #b0e0e6; /* Azul claro para poemas */
           border-left: 3px solid #87ceeb; /* Borde izquierdo destacado */
           line-height: 1.5;
        }

        /* Contenedor del chat secreto */
        #chat {
            overflow-y: auto; /* Permite scroll vertical */
            height: 300px; /* Altura aumentada */
            padding: 15px; /* M√°s padding */
            width: 100%;
            box-sizing: border-box;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #1e1e2f; /* Fondo del √°rea de chat */
            display: flex;
            flex-direction: column; /* Mensajes uno debajo del otro */
            gap: 12px; /* Espacio aumentado entre mensajes */
            margin-bottom: 10px; /* Espacio antes del input */
        }

        /* Estilo de los mensajes tipo WhatsApp */
        .mensaje-secreto {
            display: inline-block; /* Permite que el fondo se ajuste al texto */
            max-width: 75%; /* Ancho m√°ximo del mensaje */
            padding: 10px 15px; /* Padding interno */
            border-radius: 18px; /* Bordes m√°s redondeados */
            margin: 0;
            word-wrap: break-word; /* Romper palabras largas */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Fuente m√°s com√∫n en chats */
            font-size: 0.95em; /* Tama√±o de fuente ligeramente menor */
            line-height: 1.4; /* Espaciado de l√≠nea */
            box-shadow: 0 1px 2px rgba(0,0,0,0.15); /* Sombra sutil */
        }
        .mensaje-secreto strong { /* Estilo para el nombre de usuario */
             display: block; /* Nombre en l√≠nea separada */
             font-weight: 600;
             margin-bottom: 3px;
             font-size: 0.9em;
             color: inherit; /* Hereda color del padre (√∫til para diferenciar mio/otro si es necesario) */
         }

        /* Mensajes del usuario actual (a la derecha, verde) */
        .mensaje-secreto.mio {
            background-color: #075E54; /* Verde oscuro WhatsApp */
            color: #e1f5e1; /* Texto claro sobre verde */
            align-self: flex-end; /* Alinea a la derecha */
            border-bottom-right-radius: 6px; /* Esquina menos redonda */
        }
         .mensaje-secreto.mio strong {
             color: #a7ffb6; /* Color del nombre para mensajes propios */
         }

        /* Mensajes de otros usuarios (a la izquierda, gris oscuro) */
        .mensaje-secreto.otro {
            background-color: #262D31; /* Gris oscuro WhatsApp */
            color: #e0e0e0; /* Texto claro */
            align-self: flex-start; /* Alinea a la izquierda */
            border-bottom-left-radius: 6px; /* Esquina menos redonda */
        }
        .mensaje-secreto.otro strong {
            color: #87ceeb; /* Color del nombre para mensajes de otros */
        }

        /* Input y bot√≥n de enviar para chat secreto */
        #seccion-secreta .input-container { /* Target espec√≠fico para evitar conflictos */
             display: flex;
             align-items: flex-end; /* Alinear items abajo para textareas */
             gap: 8px; /* Espacio entre textarea y bot√≥n */
        }
        #mensajeInput { /* Textarea del chat secreto */
            flex-grow: 1; /* Ocupa el espacio restante */
            height: auto; /* Altura autom√°tica inicial */
            min-height: 40px; /* Altura m√≠nima */
            max-height: 120px; /* Altura m√°xima antes de scroll interno */
            padding: 10px; /* Padding */
            margin: 0; /* Sin margen extra */
        }
        #enviarMensaje { /* Bot√≥n de enviar del chat secreto */
            width: auto; /* Ancho autom√°tico */
            padding: 10px 15px; /* Padding */
            margin: 0; /* Sin margen extra */
            height: 40px; /* Altura fija alineada con min-height de textarea */
            align-self: flex-end; /* Alinear el bot√≥n abajo */
            background-color: #b48efc; /* Violeta para bot√≥n */
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #enviarMensaje:hover {
            background-color: #d8b8ff; /* Color m√°s claro al pasar el rat√≥n */
        }

        /* Botones generales en secci√≥n secreta */
        #seccion-secreta button:not(#enviarMensaje):not(#logout):not(#togglePassword) { /* Estilo para otros botones */
          background-color: #b48efc;
          color: #fff;
          border: none;
          padding: 10px 16px; /* Padding aumentado */
          border-radius: 6px;
          cursor: pointer;
          transition: background-color 0.3s ease;
          width: auto; /* Ancho autom√°tico */
          margin-right: 10px; /* Espacio entre botones */
        }
        #seccion-secreta button:not(#enviarMensaje):not(#logout):not(#togglePassword):hover {
          background-color: #d8b8ff;
        }
        #logout { /* Estilo espec√≠fico bot√≥n logout */
           background-color: #e74c3c; /* Rojo */
           color: white;
           padding: 10px 15px;
           border: none;
           cursor: pointer;
           border-radius: 6px;
           float: right; /* Alinear a la derecha */
           margin-left: 10px; /* Espacio si hay otros elementos */
           width: auto;
        }
        #logout:hover {
             background-color: #c0392b; /* Rojo m√°s oscuro */
        }


        /* Contadores y Admin Info */
        .contador-emociones,
        #admin-info {
          background-color: #2b2b3d; /* Fondo ligeramente diferente */
          border: 1px solid #555;
          padding: 15px; /* M√°s padding */
          border-radius: 8px;
          margin-top: 20px; /* M√°s espacio superior */
          color: #dddddd; /* Texto m√°s claro */
        }
        .contador-emociones h3, #admin-info h3 {
           color: #87ceeb; /* Azul claro para t√≠tulos internos */
           margin-top: 0;
           border-bottom: 1px solid #555;
           padding-bottom: 8px;
           margin-bottom: 15px;
        }
        .contador-item, .historial-item { /* Estilo para cada l√≠nea de contador/historial */
           margin-bottom: 8px;
           padding: 5px 0;
        }
        .contador-label { /* Etiqueta de la emoci√≥n */
           display: inline-block;
           width: 180px; /* Ancho fijo para alinear contadores */
        }
        .contador-valor { /* Valor del contador */
            font-weight: bold;
            color: #d18fff; /* Violeta */
        }
         #historial-container {
             max-height: 250px; /* M√°s altura para historial */
             overflow-y: auto;
             padding-right: 10px; /* Espacio para barra de scroll */
         }
         .historial-item {
             border-bottom: 1px dashed #444; /* Separador sutil */
             padding-bottom: 5px;
         }
         .historial-item span:first-child { /* Emoci√≥n */
             color: #c8a2c8; /* Lila suave */
         }
         .historial-item span:last-child { /* Fecha */
            float: right;
            font-style: italic;
            font-size: 0.9em;
            color: #aaa; /* Gris claro */
        }
         #admin-info p { margin: 8px 0; } /* Espaciado p√°rrafos admin */
         #admin-status { font-weight: bold; } /* Resaltar estado admin */

        /* Im√°genes */
        .imagenes-container {
            display: flex; /* Alineaci√≥n horizontal */
            justify-content: space-around; /* Espacio entre im√°genes */
            flex-wrap: wrap; /* Permitir que pasen a la siguiente l√≠nea en pantallas peque√±as */
            margin-top: 25px;
            gap: 20px; /* Espacio entre items */
        }
        .imagen-item {
            text-align: center; /* Centrar contenido */
            background-color: #2b2b3d;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #555;
            max-width: 320px; /* Ancho m√°ximo del contenedor de imagen */
        }
        .imagen-item img {
          max-width: 100%; /* Imagen se ajusta al contenedor */
          height: auto;
          border-radius: 8px;
          border: 2px solid #555; /* Borde alrededor de la imagen */
          display: block; /* Evitar espacio extra debajo */
          margin: 0 auto 10px auto; /* Centrar y a√±adir espacio debajo */
        }
        .imagen-emojis { margin-top: 10px; } /* Espacio sobre emojis/links */
        .imagen-emojis span, .imagen-emojis a {
           font-size: 1.5em; /* Emojis m√°s grandes */
           margin: 0 10px; /* Espacio entre emojis/links */
           text-decoration: none;
        }
        .imagen-emojis a {
           color: #b48efc; /* Color violeta para links de m√∫sica */
           transition: color 0.3s ease;
        }
         .imagen-emojis a:hover {
            color: #d8b8ff; /* M√°s claro al pasar el rat√≥n */
         }

        /* Mensaje de error login */
        #loginError {
            color: #e74c3c; /* Rojo */
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            min-height: 1.2em; /* Evita saltos de layout */
            /* display: none; /* Lo ocultamos/mostramos con JS */ /* CORRECCI√ìN: Quitar esto si se maneja con JS */
        }
    </style>
</head>
<body>
<div class="container">
<h1>El Alma del Jazz</h1>
<p>El jazz no es solo m√∫sica; es una forma de vida, un reflejo del alma humana en notas improvisadas y ritmos que laten al comp√°s del coraz√≥n. Surgi√≥ a finales del siglo XIX en las calles vibrantes de Nueva Orleans, donde las influencias del blues, el ragtime y las tradiciones africanas se fusionaron en un sonido √∫nico. Desde los clubes llenos de humo hasta los grandes escenarios del mundo, el jazz ha evolucionado, pero nunca ha perdido su esencia: la libertad de expresi√≥n.</p>
<p>Este g√©nero ha dado lugar a momentos inolvidables y artistas que han trascendido el tiempo. A lo largo de los a√±os, el jazz ha sabido adaptarse, desde el swing de los a√±os 30 hasta el bebop de los 40 y el cool jazz de los 50. Es un arte que invita a escuchar con atenci√≥n, a sentir cada nota como si contara una historia. A continuaci√≥n, exploraremos a tres de sus figuras m√°s emblem√°ticas y una selecci√≥n de canciones que capturan su esp√≠ritu.</p>
<h2>Figuras Ic√≥nicas del Jazz</h2>
<div class="figure">
<img alt="Frank Sinatra" src="https://i.imgur.com/DgMHCSb.jpeg"/>
<div class="figure-text">
<p><strong>Frank Sinatra</strong>, conocido como "La Voz", llev√≥ el jazz a nuevas alturas con su estilo suave y su habilidad para interpretar canciones con una emoci√≥n profunda. Aunque tambi√©n fue un √≠cono del pop, su contribuci√≥n al jazz vocal es innegable, especialmente en temas como "Fly Me to the Moon", donde su phrasing impecable brilla.</p>
</div>
</div>
<div class="figure">
<img alt="Ella Fitzgerald" src="https://i.imgur.com/101yBqK.jpeg"/>
<div class="figure-text">
<p><strong>Ella Fitzgerald</strong>, la "Primera Dama de la Canci√≥n", revolucion√≥ el jazz con su voz cristalina y su dominio del scat, una t√©cnica de improvisaci√≥n vocal que convirti√≥ en arte. Canciones como "Summertime" muestran su capacidad para transformar melod√≠as en pura magia.</p>
</div>
</div>
<div class="figure">
<img alt="Louis Armstrong" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Louis_Armstrong_restored.jpg/220px-Louis_Armstrong_restored.jpg"/>
<div class="figure-text">
<p><strong>Louis Armstrong</strong>, apodado "Satchmo", fue un pionero del jazz con su trompeta y su voz grave y carism√°tica. Su interpretaci√≥n de "What a Wonderful World" no solo es un himno de esperanza, sino una muestra de c√≥mo el jazz puede tocar el alma.</p>
</div>
</div>
<h2>Canciones que Definen el Jazz</h2>
<p>El jazz vive en sus melod√≠as, y estas canciones son un testimonio de su diversidad y belleza. Escucha estas piezas y d√©jate llevar por su encanto:</p>
<ul>
<li><a class="song-link" href="https://www.youtube.com/watch?v=A3yCcXgbKrE" target="_blank">"What a Wonderful World" - Louis Armstrong</a></li>
<li><a class="song-link" href="https://www.youtube.com/watch?v=u2bigf337aU" target="_blank">"Summertime" - Ella Fitzgerald</a></li>
<li><a class="song-link" href="https://www.youtube.com/watch?v=ZEcqHA7dbwM" target="_blank">"Fly Me to the Moon" - Frank Sinatra</a></li>
<li><a class="song-link" href="https://www.youtube.com/watch?v=vmDDOFXSgAs&amp;pp=ygUJdGFrZSBmaXZl" target="_blank">"Take Five" - Dave Brubeck</a></li>
<li><a class="song-link" href="https://www.youtube.com/watch?v=ylXk1LBvIqU" target="_blank">"So What" - Miles Davis</a></li>
</ul>
<h2>Comentarios</h2>
<div class="chat-container">
<div id="chat-publico"></div>
<div class="input-container">
<textarea id="mensajeInputPublico" placeholder="Deja tu comentario..." rows="1"></textarea> <!-- rows="1" para empezar peque√±o -->
<button id="enviarMensajePublico">Enviar</button>
</div>
</div>
<h2>Un Legado Eterno</h2>
<p>El jazz es un g√©nero que nunca envejece. Cada acorde, cada improvisaci√≥n, lleva consigo las historias de quienes lo crearon y lo vivieron. Desde los bares clandestinos de la Prohibici√≥n hasta las salas de concierto modernas, su esp√≠ritu sigue resonando. Es un recordatorio de que la m√∫sica puede ser un refugio, una protesta o una celebraci√≥n, todo al mismo tiempo.</p>
<p>Si te apasiona este arte, sum√©rgete en sus ra√≠ces, descubre sus leyendas y d√©jate envolver por sus <a class="secret-link" href="#" id="palabra-secreta">melod√≠as</a>.</p>
<!-- Secci√≥n secreta -->
<div id="seccion-secreta">
<div id="loginContainer">
<h2>Iniciar Sesi√≥n</h2>
<input id="email" placeholder="Correo electr√≥nico" required="" type="email"/>
<div class="password-container">
<input id="password" placeholder="Contrase√±a" required="" type="password"/>
<button id="togglePassword" type="button">üëÅ</button>
</div>
<button id="login">Iniciar sesi√≥n</button>
<p id="loginError" style="display: none;"></p> <!-- Aseguramos que est√© oculto por defecto -->
</div>
<div id="contenido-secreto" style="display: none;">

<div id="admin-info" style="display: none;"> <!-- Oculto por defecto -->
<h3>Panel de administrador</h3>
<p id="usuario-actual-info">Usuario actual: <strong id="usuario-nombre">No detectado</strong></p>
<p id="admin-status-info">Estado de administrador: <strong id="admin-status">No</strong></p>
</div>
<h2>Mi Rinc√≥n Especial ‚ú®</h2>
<p>¬øC√≥mo te sientes hoy, mi ni√±a?</p>
<select id="emocion">
<option value="feliz">Feliz üòä</option>
<option value="triste">Triste üòî</option>
<option value="estresada">Estresada üòµ‚Äçüí´</option>
<option value="cansada">Cansada ü•±</option>
<option value="extra√±andote">Extra√±√°ndote ü•∫</option>
<option value="pensandoEnTi">Pensando en ti üí≠‚ù§Ô∏è</option>
<option value="conGanasDeVerte">Con ganas de verte ü•∞</option>
<option value="conGanasDePensar">Con ganas de "pensar" üòè</option>
</select>
<button onclick="mostrarMensaje()">Ver mensaje</button>
<button onclick="mostrarPoema()">Poema del d√≠a</button>
<p id="mensaje"></p>
<p id="poema"></p>
<div class="contador-emociones" id="contador-emociones" style="display: none;"> <!-- Oculto por defecto -->
<h3>Contador de Emociones ‚ù§Ô∏è</h3>
<div id="contadores-container"></div>
</div>
<div class="contador-emociones" id="historial-emociones" style="display: none;"> <!-- Oculto por defecto -->
<h3>Historial de Emociones ‚è±Ô∏è</h3>
<div id="historial-container"></div>
</div>
<div class="imagenes-container">
<div class="imagen-item">
<img alt="Piano con notas musicales" src="https://i.imgur.com/8jWcK6P.png"/>
<div class="imagen-emojis">
<span>‚ù§Ô∏è</span>
<a href="https://youtu.be/M7k5tjw3-0M" target="_blank">üéµ</a>
</div>
</div>
<div class="imagen-item">
<img alt="Estrellita especial" src="https://i.imgur.com/qO3JLoN.jpeg"/>
<div class="imagen-emojis">
<span>‚ù§Ô∏è</span>
<a href="https://www.youtube.com/watch?v=ITbjjKDDSO0&amp;pp=ygUgbGEgbWVqb3IgdmVyc2nDs24gam9zZSB5IGVsIHRvcm8%3D" target="_blank">üéµ</a>
</div>
</div>
</div>
<h2>Comentarios</h2>
<div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-bottom: 15px;">
    <h2 style="margin: 0; flex-grow: 1; color: #d18fff;">
    <button id="borrarChatBtn" style="display: none;">Borrar Chat</button>
    <button id="logout">Cerrar Sesi√≥n</button>
</div>
<div class="chat-container"> <!-- Reutilizamos clase para consistencia -->
<div id="chat"></div> <!-- √Årea de mensajes del chat secreto -->
<div class="input-container"> <!-- Contenedor para input y bot√≥n -->
<textarea id="mensajeInput" placeholder="Escribe un mensaje..." rows="1"></textarea> <!-- rows="1" inicial -->
<button id="enviarMensaje">Enviar</button>
</div>
</div>
</div> <!-- Fin de contenido-secreto -->
</div> <!-- Fin de seccion-secreta -->
</div> <!-- Fin de container principal -->
<script>
        // --- C√≥digo JS NO modular (frases, poemas, funciones mostrarMensaje/Poema, listeners b√°sicos) ---

        const frases = {
            feliz: [
                "Me encanta saber que est√°s feliz, mi ni√±a. Siempre quiero verte as√≠. üå∏", "Tu felicidad es mi felicidad. Que nunca te falte una sonrisa. üòä",
                "Hoy el sol brilla m√°s porque t√∫ est√°s feliz. ‚òÄÔ∏èüíñ", "No hay nada que me haga m√°s feliz que verte sonre√≠r. üí´",
                "Quisiera guardar este momento en un frasco y abrirlo cuando lo necesitemos. üéÄ", "Cuando eres feliz, haces del mundo un lugar mejor. üåç‚ú®",
                "Si tu alegr√≠a tuviera sonido, ser√≠a mi canci√≥n favorita. üé∂üíñ", "Disfruta este momento, porque te lo mereces. üíï",
                "Cada risa tuya es un regalo para m√≠. üéÅüòä", "Me encanta la forma en que iluminas todo con tu alegr√≠a. ‚ú®",
                "Que este d√≠a sea solo el comienzo de una larga felicidad. üíõ", "Estar feliz es como volar sin alas, ¬øverdad? üïäÔ∏è",
                "Recuerda siempre estos momentos y gu√°rdalos en tu coraz√≥n. üíñ", "Si supieras lo hermosa que te ves cuando sonr√≠es... ü•∞",
                "Ojal√° pudiera congelar este instante y guardarlo para siempre. ‚ùÑÔ∏è‚ù§Ô∏è", "Mi deseo es que nunca pierdas esa luz que llevas dentro. üåü",
                "Que cada d√≠a sea m√°s brillante que el anterior. ‚ú®üåà", "Tu felicidad es contagiosa, y me encanta ser contagiado. üòÜüíñ",
                "No importa lo que pase, siempre hay motivos para sonre√≠r. üòä", "Hoy es un d√≠a perfecto porque t√∫ lo hiciste as√≠. üå∑üíñ",
                "Que cada paso que des est√© lleno de alegr√≠a. üöÄ", "Sonr√≠e, porque te mereces toda la felicidad del mundo. üòç",
                "Si el mundo tuviera m√°s personas como t√∫, ser√≠a un mejor lugar. üåéüíñ", "Qu√© bonito es verte tan radiante. üåû‚ú®",
                "La felicidad es un camino, y t√∫ lo recorres con gracia. üö∂‚Äç‚ôÄÔ∏èüíõ", "Vive el momento, porque la felicidad est√° en los peque√±os detalles. üéà",
                "Me siento afortunado de compartir tu felicidad. üíï", "Un d√≠a lleno de alegr√≠a es un d√≠a bien vivido. üå∏",
                "Que tu sonrisa nunca se apague, porque ilumina mi mundo. üíñ", "No dejes que nada ni nadie apague esta felicidad. ¬°Brilla! üåü"
            ],
            triste: [
                "Recuerda que, pase lo que pase, siempre estar√© para ti. üíï", "Las nubes pasan, pero el cielo sigue ah√≠. Y yo tambi√©n estar√© siempre contigo. üåßÔ∏è‚ù§Ô∏è",
                "Si est√°s triste, piensa en lo mucho que significas para m√≠. üíñ", "No importa la tormenta, el sol siempre vuelve a brillar. ‚òÄÔ∏è",
                "A veces, llorar tambi√©n es parte de sanar. Estoy aqu√≠ para ti. üíô", "Te mando un abrazo que dure hasta que vuelvas a sonre√≠r. ü§óüíñ",
                "No tienes que ser fuerte todo el tiempo. Est√° bien sentirse as√≠. üíï", "Aunque no lo parezca, este momento dif√≠cil pasar√°. üåà",
                "Si necesitas un hombro en el que apoyarte, siempre tendr√°s el m√≠o. üíõ", "Me gustar√≠a poder quitarte toda la tristeza con un solo abrazo. ü´Ç",
                "Respira hondo y recuerda lo fuerte que eres. üå∏", "No hay tristeza eterna, solo momentos que nos ense√±an. üíñ",
                "Aunque no lo creas, todo esto tiene un prop√≥sito. üåü", "Cuando todo se sienta oscuro, piensa en la luz que llevas dentro. üî•",
                "Incluso la noche m√°s larga tiene su amanecer. üåÖ", "Recuerda cu√°nto has logrado y lo incre√≠ble que eres. üíï",
                "Si supieras lo mucho que vales, nunca estar√≠as triste. üíñ", "Eres m√°s fuerte de lo que crees, y yo creo en ti. üå∏",
                "Siempre hay un nuevo comienzo esperando por ti. üí´", "No est√°s sola. Aqu√≠ estoy, contigo. üíï"
            ],
            estresada: [
                "Respira hondo, mi amor. Todo estar√° bien. üíï", "No tienes que hacerlo todo de una vez, paso a paso. ü¶ã",
                "Cierra los ojos por un momento y deja que el estr√©s se disuelva. ‚ú®", "Incluso las tormentas m√°s fuertes pasan, y esta tambi√©n lo har√°. ‚õàÔ∏è",
                "Si el mundo pesa demasiado, deja que comparta la carga contigo. üíõ", "Hoy puede ser dif√≠cil, pero eres m√°s fuerte de lo que crees. üí™",
                "No dejes que el estr√©s te haga olvidar lo incre√≠ble que eres. üíñ", "Descansa un momento, tu bienestar es lo m√°s importante. üåø",
                "Un respiro profundo puede hacer maravillas. Inhala‚Ä¶ Exhala‚Ä¶ üå¨Ô∏è", "Recuerda que siempre puedes contar conmigo. ü´Çüíñ",
                "Cada desaf√≠o te est√° haciendo m√°s fuerte, aunque no lo parezca. üèãÔ∏è‚Äç‚ôÄÔ∏è", "No dejes que la presi√≥n te quite la alegr√≠a de cada d√≠a. üí´",
                "Est√° bien parar un momento y simplemente respirar. ‚è≥", "Hoy enf√≥cate en lo que puedes controlar y deja ir el resto. üéà",
                "Incluso cuando sientas que todo se descontrola, aqu√≠ estoy yo para ti. üíï", "Prioriza lo m√°s importante: t√∫. ‚ú®üíñ",
                "Un mal d√≠a no significa una mala vida. ‚òÄÔ∏èüíõ", "T√≥mate tu tiempo, las prisas no llevan a nada bueno. üö∂‚Äç‚ôÄÔ∏è",
                "A veces, un peque√±o descanso hace toda la diferencia. üåä", "Date permiso para desconectar y recargar energ√≠as. üîã",
                "No dejes que el estr√©s te impida disfrutar las peque√±as cosas. üå∑", "Recuerda por qu√© empezaste, pero tambi√©n perm√≠tete descansar. üåü",
                "Tu esfuerzo es admirable, pero tambi√©n lo es tu bienestar. üíñ", "A veces, lo mejor que puedes hacer es dejarlo ir y seguir adelante. üïäÔ∏è",
                "La calma llegar√°, solo aguanta un poco m√°s. üíõ", "Si hoy sientes que el mundo pesa, recuerda que no lo cargas sola. ü´Ç",
                "Est√°s haciendo lo mejor que puedes, y eso ya es suficiente. üå∏", "Eres fuerte, incluso cuando no lo sientas. üí™",
                "T√≥mate un respiro, la vida no es una carrera. üåø", "Ma√±ana ser√° un nuevo d√≠a, lleno de oportunidades. üåÖ"
            ],
            cansada: [
                "Cierra los ojos un momento, descansa, yo cuidar√© de ti. üíï", "A veces lo mejor que puedes hacer es dormir y empezar de nuevo ma√±ana. üåô",
                "No tienes que hacerlo todo hoy, t√≥mate tu tiempo. ‚è≥", "Descansa, mi amor. Nada es m√°s importante que tu bienestar. üå∏",
                "Dormir es como reiniciar el alma. Date permiso de hacerlo. üîÑüíñ", "Si el d√≠a fue agotador, perm√≠tete un momento de tranquilidad. üåø",
                "Apoya la cabeza, cierra los ojos y deja que el cansancio se disuelva. üí§", "Te mando un abrazo lleno de calma y paz. ü§óüíõ",
                "La fatiga no define lo incre√≠ble que eres. üí´", "Un d√≠a a la vez, mi amor. No hay prisa, descansa. üíï",
                "Recuerda que hasta las estrellas necesitan descansar. üåü", "Tu cuerpo y mente te est√°n pidiendo un respiro. Esc√∫chalos. ü¶ã",
                "El descanso tambi√©n es productividad. üõå‚ú®", "T√≥mate un momento para ti, lo mereces. üéÄ",
                "No importa lo que pase, todo puede esperar. Tu bienestar primero. üíõ", "No te sientas culpable por descansar, es necesario. üåø",
                "Un caf√©, una siesta o una pausa pueden hacer maravillas. ‚òïüíñ", "Rel√°jate, respira y deja que la calma entre en ti. üåä",
                "Cuando despiertes, ver√°s las cosas con m√°s claridad. üåÖ", "Hoy te ganaste el derecho de descansar sin remordimientos. üíï",
                "A veces, descansar es la mejor forma de seguir adelante. üö∂‚Äç‚ôÄÔ∏èüíõ", "Cierra los ojos, piensa en algo lindo y deja que el sue√±o te abrace. üíñ",
                "No hay prisa, todo estar√° aqu√≠ cuando despiertes. üå∏", "Ma√±ana ser√° un nuevo d√≠a, lleno de oportunidades. üåü",
                "Cuando est√©s lista, sigue adelante. Por ahora, descansa. üí§", "Deja que el cansancio se disuelva y la tranquilidad tome su lugar. üíï",
                "Un buen descanso puede cambiar todo. üåôüíñ", "Nadie puede ser fuerte todo el tiempo. Perm√≠tete un respiro. üíõ",
                "Me gustar√≠a estar ah√≠ para abrazarte hasta que duermas. ü§ó", "No tienes que cargar el mundo, solo descansar y ser t√∫. ‚ú®"
            ],
            extra√±andote: [
                "T√∫ dices que me extra√±as... Pero yo te extra√±o m√°s. Y lo sabes. ü•∫‚ù§Ô∏è", "La distancia solo hace que te quiera m√°s. üí´",
                "Ojal√° pudiera abrazarte ahora mismo. üíñ", "Cierro los ojos y te imagino aqu√≠ conmigo. üåô",
                "Cada d√≠a sin ti es un d√≠a menos para verte otra vez. ‚è≥üíõ", "Si pudiera teletransportarme, ya estar√≠a contigo. üöÄüíï",
                "Contando los d√≠as, las horas y los minutos para verte. üï∞Ô∏èüíñ", "Te extra√±o tanto que hasta el aire parece m√°s pesado sin ti. üíï",
                "Mi coraz√≥n late diferente cuando no est√°s cerca. üíò", "Extra√±arte es la parte m√°s dif√≠cil de mi d√≠a. üòî",
                "A veces, desear√≠a que el tiempo corriera m√°s r√°pido. ‚è≥üíõ", "Si el amor pudiera acortar distancias, ya estar√≠amos juntos. ü•∞",
                "No importa d√≥nde est√©s, mi coraz√≥n siempre te sigue. üíñ", "Cada d√≠a sin ti es un peque√±o desaf√≠o que supero con amor. üíï",
                "Ojal√° pudieras ver cu√°nto te echo de menos. üí´", "Pensar en ti es mi forma de sentirte cerca. üíõ",
                "No importa la distancia, siempre estamos conectados. üåç‚ú®", "Aunque no estemos juntos, s√© que piensas en m√≠ como yo en ti. ü•∞",
                "Es dif√≠cil no verte, pero lo que siento por ti lo hace m√°s llevadero. üíñ", "A veces, extra√±o hasta el sonido de tu voz. üìûüíï",
                "Si el tiempo pudiera ir m√°s r√°pido cuando no est√°s‚Ä¶ ‚è≥üíõ", "Dicen que la ausencia hace crecer el amor, y yo lo siento cada d√≠a. ‚ù§Ô∏è",
                "No importa cu√°nto tiempo pase, siempre te extra√±ar√© igual. üíï", "Te pienso tanto que casi parece que est√°s aqu√≠. üíñ",
                "No hay un solo d√≠a en el que no desee verte. ü•∞", "Quisiera que el universo conspirara para juntarnos ahora mismo. üåü",
                "La espera es dura, pero valdr√° la pena cuando te vea otra vez. üí´", "Si pudiera pedir un deseo, ser√≠a estar contigo ahora. üíï",
                "A veces, solo quiero cerrar los ojos y que, al abrirlos, est√©s aqu√≠. üòî", "Mientras te extra√±o, me consuela saber que t√∫ tambi√©n piensas en m√≠. üíñ"
            ],
            pensandoEnTi: [
                "Ahora mismo estaba pensando en ti‚Ä¶ Aunque en realidad, siempre lo hago. ü•∞", "Eres mi pensamiento favorito del d√≠a. üí≠‚ù§Ô∏è",
                "Si supieras cu√°ntas veces pienso en ti al d√≠a, te asustar√≠as. üòÜüíì", "Pensarte se ha vuelto mi pasatiempo favorito. üíï",
                "Cada pensamiento bonito que tengo, de alguna forma, termina en ti. üå∏", "A veces, sin darme cuenta, sonr√≠o porque te estoy recordando. üòä‚ù§Ô∏è",
                "¬øSabes lo bonito que es despertar y que mi primer pensamiento seas t√∫? üíõ", "Si me pagaran por cada vez que pienso en ti, ya ser√≠a millonario. üí∞üíï",
                "Est√°s en mis pensamientos como una melod√≠a que no quiero dejar de escuchar. üé∂", "A veces, te imagino aqu√≠ conmigo, y mi d√≠a se siente m√°s bonito. üå∑",
                "Me encanta perderme en mis pensamientos cuando el tema eres t√∫. üíñ", "Aunque est√© ocupado, siempre hay un rinconcito en mi mente reservado para ti. üß†üíò",
                "¬øC√≥mo logras habitar mis pensamientos las 24 horas del d√≠a? ü§îüíõ", "Si el pensamiento pudiera teletransportarme, ya estar√≠a contigo. üöÄüíñ",
                "Hay momentos en los que el mundo se queda en pausa‚Ä¶ Porque me pierdo pensando en ti. ‚è≥üíï", "Si pudiera dibujar mi mente, estar√≠a llena de recuerdos contigo. üñåÔ∏èüíñ",
                "Te pienso tanto que hasta en mis sue√±os te apareces. üåôüí´", "¬øSabes lo que m√°s me gusta de pensar en ti? Que me hace sentir cerca de ti. üíï",
                "A veces, ni siquiera me doy cuenta de cu√°nto te pienso‚Ä¶ Hasta que alguien me lo se√±ala. üòäüíñ", "Si cada pensamiento sobre ti fuera una estrella, el cielo de mi mente estar√≠a iluminado siempre. ‚ú®üåô",
                "No hay un solo d√≠a en el que no aparezcas en mi mente al menos una vez. üíõ", "Si el amor se midiera en pensamientos, creo que el m√≠o por ti es infinito. ‚ôæÔ∏èüíñ",
                "Te pienso tanto que siento que el universo ya deber√≠a habernos juntado. üåçüíï", "No s√© si eres un pensamiento en mi mente o un latido en mi coraz√≥n‚Ä¶ Quiz√° ambos. üíìüí≠",
                "¬øQu√© har√© el d√≠a que te tenga a mi lado y ya no tenga que imaginarte? ü•∫üíñ", "Cuando el mundo se pone ruidoso, pensar en ti es mi refugio. üíï",
                "Me gusta cuando pienso en ti y, de repente, me llega un mensaje tuyo. ¬øConexi√≥n? üòèüíò", "Cada vez que el d√≠a se siente dif√≠cil, pensar en ti me da fuerzas. üí™üíñ",
                "En mi lista de pensamientos importantes, t√∫ siempre ocupas el primer lugar. ü•áüíñ", "A veces, solo quiero decirte: 'Estoy pensando en ti'. üí≠‚ù§Ô∏è"
            ],
            conGanasDeVerte: [
                "Ojal√° pudiera verte ahora mismo. ¬øSabes cu√°nto dar√≠a por eso? Much√≠simo. üíñ", "Contando los d√≠as para verte de nuevo‚Ä¶ Porque cada segundo sin ti es un siglo. ‚è≥‚ù§Ô∏è",
                "Si pudiera teletransportarme, ya estar√≠a contigo. üí´", "Extra√±o mirarte a los ojos y perderme en ellos. üëÄüíï",
                "El d√≠a en que te vea otra vez, no te voy a soltar ni un segundo. ü•∞", "Quisiera que el universo conspirara para juntarnos ahora mismo. üåü",
                "A veces, todo lo que necesito es verte y abrazarte fuerte. ü§óüíñ", "Si tuviera un deseo, ser√≠a poder verte hoy mismo. ‚ú®",
                "No importa cu√°nto tiempo pase, siempre tendr√© ganas de verte. üíõ", "Contando los segundos para nuestro pr√≥ximo encuentro. ‚è≥üíï",
                "Verte es como un regalo que siempre espero con ansias. üéÅüíñ", "No hay nada que quiera m√°s ahora mismo que verte y decirte cu√°nto te quiero. üíò",
                "Mi d√≠a no est√° completo sin verte, aunque sea un ratito. ‚òÄÔ∏èüíï", "Ojal√° pudiera robarte un momento y verte aunque sea de lejos. üëÄüíñ",
                "Si pudiera detener el tiempo cuando estemos juntos, lo har√≠a sin dudarlo. ‚è≥üíõ", "Hay muchas cosas que quiero hacer‚Ä¶ Pero todas empiezan con verte. üíï",
                "La distancia es cruel cuando lo √∫nico que quiero es verte sonre√≠r. üòäüíñ", "¬øSabes ese vac√≠o en el pecho? Es porque me faltas t√∫. ü•∫üíï",
                "Cuando por fin te vea, no querr√© despedirme. Nunca. üíõ", "Ya no s√© qu√© hacer con tantas ganas de verte‚Ä¶ üíï",
                "Si verte fuera un medicamento, lo necesitar√≠a todos los d√≠as. üíäüíñ", "El mejor momento del d√≠a ser√° cuando por fin estemos frente a frente. ü•∞",
                "No hay nada que me emocione m√°s que la idea de verte de nuevo. üåüüíò", "Quisiera que el destino nos diera una sorpresa y nos hiciera coincidir hoy. üòçüíï",
                "Cada d√≠a sin verte es un d√≠a menos para el reencuentro. ‚è≥üíñ", "¬øY si nos encontramos sin planearlo? Ser√≠a el mejor accidente del mundo. üòèüíï",
                "No importa cu√°nto tiempo pase, mis ganas de verte solo crecen. üíõ", "Te imagino aqu√≠ conmigo y sonr√≠o solo de pensarlo. üòäüíñ",
                "Dicen que la espera vale la pena‚Ä¶ Pero yo ya no quiero esperar. ü•∫üíï", "El d√≠a en que te vea otra vez, te recordar√© cu√°nto te extra√±√©. ‚ù§Ô∏è"
            ],
            conGanasDePensar: [
                "¬øOtra vez con ganas de 'pensar'? üòè Bueno‚Ä¶ Yo tambi√©n. ‚ù§Ô∏è‚Äçüî•", "Pensar contigo siempre es una buena idea. üòâ",
                "Si te digo lo que estoy pensando ahora‚Ä¶ üò≥", "A veces siento que tu 'pensar' tiene doble sentido. üòè",
                "Cuando dices eso, solo me da m√°s curiosidad‚Ä¶ üòÜ", "Me gusta cuando dices que tienes ganas de 'pensar'‚Ä¶ ¬øDe qu√© tipo de pensamiento hablamos? üòè",
                "Hay pensamientos que deber√≠an guardarse‚Ä¶ Pero otros deber√≠an compartirse. ü§≠", "Entre pensar y hacer‚Ä¶ Solo hay un paso. üòè",
                "¬øSeguro que quieres decirme lo que est√°s pensando? üò≥", "No s√© si est√°s pensando lo mismo que yo‚Ä¶ Pero espero que s√≠. üòè",
                "Tu forma de pensar me encanta. üíñ", "Si lo que piensas es lo que imagino‚Ä¶ Entonces s√≠. üòè",
                "A veces, 'pensar' es solo una excusa. üòâ", "Me encanta cuando te pones en modo pensativa. üòç",
                "Pensar contigo es peligroso‚Ä¶ Pero me encanta. üòè", "Hay pensamientos que no deber√≠an decirse‚Ä¶ Pero contigo quiero compartirlos todos. üòâ",
                "¬øDe verdad est√°s pensando eso? Porque yo tambi√©n. üòÜ", "Me pregunto si tu 'pensar' se parece al m√≠o‚Ä¶ üòè",
                "Si est√°s pensando lo que creo‚Ä¶ üëÄ", "¬øSegura que solo quieres 'pensar'? üòè"
            ]
        };

        const poemas = [
            "ENTRE N√öMEROS Y LETRAS\n\nEntre n√∫meros y letras\nsurgi√≥ una rosa en una libreta.\nEntre ecuaciones y canciones\nsurgieron nuestros amores.",
            "TOMA MI MANO\n\nToma mi mano,\ny acomp√°√±ame al camino\nde la vida.\n\nToma mi mano,\ny recorramos la senda,\nde por vida.",
            // ... (A√±ade el resto de tus poemas aqu√≠ para que funcione obtenerPoemaDiario) ...
            "LA LUNA COMO NUNCA\n\nHe visto la luna como nunca antes.\nTan brillante y c√°lida como el sol.\nHe visto c√≥mo deslumbra su reflejo,\ncapaz de despertar el coraz√≥n.\nHe visto c√≥mo con su mirada\nllora y expresa mucho dolor,\nal traer a memoria aquellos d√≠as\nen que yo admiraba su expresi√≥n.\n\n¬°Qu√© inocencia la de mi luna!\nNo conoce mi intenci√≥n.\nNo me he olvidado de ella,\na√∫n le compongo mi canci√≥n."
        ];
         // Rellenar poemas si hay menos de 365
         while (poemas.length > 0 && poemas.length < 365) { // Evitar bucle infinito si est√° vac√≠o
             poemas.push(poemas[Math.floor(Math.random() * poemas.length)]);
         }

        function obtenerDiaDelA√±o() {
            const ahora = new Date();
            const inicioA√±o = new Date(ahora.getFullYear(), 0, 1);
            const diferencia = ahora - inicioA√±o;
            return Math.floor(diferencia / (1000 * 60 * 60 * 24));
        }

        function obtenerPoemaDiario() {
            const hoy = new Date().toISOString().split("T")[0];
            const clave = `poema-${hoy}`;
            let poemaGuardado = localStorage.getItem(clave);
            if (!poemaGuardado && poemas.length > 0) { // Asegurarse de que hay poemas
                const diaDelA√±o = obtenerDiaDelA√±o();
                poemaGuardado = poemas[diaDelA√±o % poemas.length]; // Usar m√≥dulo por si acaso
                localStorage.setItem(clave, poemaGuardado);
            }
            return poemaGuardado || "No hay poema disponible para hoy."; // Fallback
        }

        function mostrarPoema() {
            const poemaDiv = document.getElementById("poema");
            if(poemaDiv) { // Verificar si existe
                poemaDiv.innerText = obtenerPoemaDiario();
            }
        }

        function obtenerFraseDiaria(emocion) {
            const hoy = new Date().toISOString().split("T")[0];
            const clave = `frase-${emocion}-${hoy}`;
            let fraseGuardada = localStorage.getItem(clave);
            if (!fraseGuardada) {
                const frasesDisponibles = frases[emocion];
                if (!frasesDisponibles || frasesDisponibles.length === 0) return "Hmm, no s√© qu√© decir a eso ahora mismo."; // Fallback
                fraseGuardada = frasesDisponibles[Math.floor(Math.random() * frasesDisponibles.length)];
                localStorage.setItem(clave, fraseGuardada);
            }
            return fraseGuardada;
        }

        function mostrarMensaje() {
            const emocionSelect = document.getElementById("emocion");
            if (!emocionSelect) return;
            const emocion = emocionSelect.value;
            const mensaje = obtenerFraseDiaria(emocion);
            const mensajeP = document.getElementById("mensaje");
             if (mensajeP) mensajeP.innerText = mensaje;

            if (typeof window.incrementarContadorEmocion === 'function') {
                 window.incrementarContadorEmocion(emocion);
             } else {
                 console.warn("incrementarContadorEmocion no est√° disponible globalmente.");
             }
        }

        // --- Chat p√∫blico ---
         const mensajesFijosPublicos = [
             { usuario: "JazzFanatic", mensaje: "¬°Qu√© gran interpretaci√≥n de Miles Davis en So What!" },
             { usuario: "MusicLover", mensaje: "Summertime de Ella Fitzgerald es pura magia. ‚ú®" },
             { usuario: "Juan R.", mensaje: "Take Five siempre me pone de buen humor. ¬°Un cl√°sico!" },
             { usuario: "SmoothJazz", mensaje: "Frank Sinatra tiene una voz inconfundible. Fly me to the moon! üöÄ" }
         ];

         function sanitizarTextoGlobal(texto) {
             if (typeof texto !== 'string') texto = String(texto);
             const temp = document.createElement('div');
             temp.textContent = texto;
             return temp.innerHTML;
         }

         function mostrarMensajeChatPublico(data) {
             const chat = document.getElementById("chat-publico");
             if (!chat) return;
             const mensajeElemento = document.createElement("div");
             mensajeElemento.classList.add("mensaje-item");
             const usuarioSanitizado = sanitizarTextoGlobal(data.usuario || "An√≥nimo");
             const mensajeSanitizado = sanitizarTextoGlobal(data.mensaje);
             mensajeElemento.innerHTML = `<p><strong>${usuarioSanitizado}:</strong> ${mensajeSanitizado}</p>`;
             chat.appendChild(mensajeElemento);
             chat.scrollTop = chat.scrollHeight;

             if (!data.fijo) {
                 setTimeout(() => {
                    if (mensajeElemento.parentNode === chat) {
                         mensajeElemento.remove();
                    }
                 }, 90000); // 90 segundos
            }
         }

         document.addEventListener('DOMContentLoaded', () => {
             mensajesFijosPublicos.forEach(mensaje => mostrarMensajeChatPublico({ ...mensaje, fijo: true }));
         });

         const enviarBtnPublico = document.getElementById("enviarMensajePublico");
         const inputPublico = document.getElementById("mensajeInputPublico");

         if (enviarBtnPublico && inputPublico) {
            enviarBtnPublico.addEventListener("click", () => {
                const mensaje = inputPublico.value.trim();
                if (mensaje) {
                    const nombreUsuario = window.nombreUsuarioLogueado || "T√∫";
                    mostrarMensajeChatPublico({ usuario: nombreUsuario, mensaje: mensaje });
                    inputPublico.value = "";
                }
            });

             inputPublico.addEventListener("keypress", function(event) {
                 if (event.key === "Enter" && !event.shiftKey) {
                     event.preventDefault();
                     enviarBtnPublico.click();
                 }
             });
         }


        // --- Palabra secreta y toggle password ---
        const palabraSecretaLink = document.getElementById("palabra-secreta");
        const seccionSecretaDiv = document.getElementById("seccion-secreta");
        if (palabraSecretaLink && seccionSecretaDiv) {
            palabraSecretaLink.addEventListener("click", (e) => {
                e.preventDefault();
                seccionSecretaDiv.style.display = "block";
                seccionSecretaDiv.scrollIntoView({ behavior: 'smooth' });
            });
        }

        const togglePasswordBtn = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        if (togglePasswordBtn && passwordInput) {
             togglePasswordBtn.addEventListener("click", () => {
                const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                passwordInput.setAttribute("type", type);
                togglePasswordBtn.textContent = type === "password" ? "üëÅ" : "üôà";
             });
         }

         if (passwordInput) {
            passwordInput.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    const loginBtn = document.getElementById("login");
                    if (loginBtn) loginBtn.click();
                }
            });
         }
        const emailInput = document.getElementById("email");
        if (emailInput && passwordInput) {
            emailInput.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    passwordInput.focus();
                }
            });
        }

</script>
<!-- ============================================================== -->
<!-- ESTE ES EL SCRIPT MODULE DEL ARCHIVO QUE S√ç FUNCIONA          -->
<!-- ASEG√öRATE DE REEMPLAZAR TUS CLAVES REALES EN firebaseConfig    -->
<!-- ============================================================== -->
<script type="module">
        // --- C√≥digo JS Modular (Firebase, l√≥gica de usuario, chat secreto, etc.) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, onChildAdded, get, set, onValue, serverTimestamp, onDisconnect, query, limitToLast, orderByChild, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ========================================================================
        // ¬°¬°¬° IMPORTANTE !!!
        // REEMPLAZA ESTOS VALORES CON LOS DE TU PROYECTO FIREBASE
        // Ve a Project Settings (icono de engranaje) -> General -> Your apps -> SDK setup and configuration
        // ========================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAcweOs5qS3v4xbzmkYCFLKxVaSWVsly_M",
            authDomain: "estrellita-chl.firebaseapp.com",
            databaseURL: "https://estrellita-chl-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "estrellita-chl",
            storageBucket: "estrellita-chl.firebasestorage.app",
            messagingSenderId: "1006618062076",
            appId: "1:1006618062076:web:8cc3a6bb3ebe800d11fb79",
            measurementId: "G-X2K8ZCR608"
        };
        // ========================================================================
        // ¬°¬°¬° ASEG√öRATE TAMBI√âN !!!
        // 1. Haber habilitado "Email/Password" en Firebase -> Authentication -> Sign-in method
        // 2. Haber creado usuarios en Firebase -> Authentication -> Users
        // ========================================================================

        let app;
        let auth;
        let db;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app); // Pasar app es buena pr√°ctica
            db = getDatabase(app); // Pasar app es buena pr√°ctica
            console.log("Firebase inicializado correctamente.");
        } catch (error) {
             console.error("¬°ERROR GRAVE AL INICIALIZAR FIREBASE!", error);
             alert("Error cr√≠tico al conectar con Firebase. Revisa la configuraci√≥n en el c√≥digo y la consola (F12) para m√°s detalles.");
             // Detener la ejecuci√≥n de m√°s c√≥digo Firebase si la inicializaci√≥n falla
             // Podr√≠as ocultar la secci√≥n secreta o mostrar un mensaje permanente
             const loginContainerEl = document.getElementById("loginContainer");
             const contenidoSecretoEl = document.getElementById("contenido-secreto");
             if(loginContainerEl) loginContainerEl.innerHTML = "<h2>Error de conexi√≥n</h2><p>No se pudo inicializar Firebase. Revisa la consola.</p>";
             if(contenidoSecretoEl) contenidoSecretoEl.style.display = 'none';
             // Lanzar el error de nuevo para detener el script si es necesario,
             // o simplemente no continuar con el resto del c√≥digo que depende de Firebase.
             // throw error; // Descomentar si quieres detener todo
             // Salir de este script si Firebase no inicializa
             // ¬°IMPORTANTE! Esto significa que el resto del c√≥digo en este <script type="module"> no se ejecutar√°.
             // Aseg√∫rate de que la UI refleje este estado de error.
             // Alternativamente, puedes envolver todo el c√≥digo dependiente de Firebase en el 'try' o usar banderas.
             // Por simplicidad aqu√≠, asumimos que si falla, mucho no funcionar√°.
             // A√±adiremos chequeos de 'auth' y 'db' m√°s adelante por si acaso.
        }


        const USUARIO_ESTRELLITA = "oras5982"; // Cambia si el usuario es diferente
        const USUARIO_ADMIN = "jahaziel.alvarezreyes"; // Cambia si el admin es diferente

        // --- Referencias a elementos del DOM (Login) ---
        const loginButton = document.getElementById("login");
        const logoutButton = document.getElementById("logout");
        const emailInputLogin = document.getElementById("email"); // Renombrado para evitar confusi√≥n
        const passwordInputLogin = document.getElementById("password"); // Renombrado para evitar confusi√≥n
        const loginError = document.getElementById("loginError");
        const loginContainer = document.getElementById("loginContainer");
        const contenidoSecreto = document.getElementById("contenido-secreto");

        // --- Otras referencias y variables globales del m√≥dulo ---
        const enviarBtnSecreto = document.getElementById("enviarMensaje");
        const inputSecreto = document.getElementById("mensajeInput");
        let inactivityTimer;
        let usuarioActual = ""; // Almacena el nombre corto (sin @...)
        let nombreUsuarioLogueado = ""; // Almacena el nombre a mostrar ("Estrellita", "Luna", etc.)
        window.nombreUsuarioLogueado = ""; // Para acceso desde chat p√∫blico
        let loginTime = null;
        let mensajesMostrados = new Set(); // Para evitar duplicados en el chat secreto

        // --- Funciones Utilitarias y de Configuraci√≥n ---

        function sanitizarTexto(texto) {
            if (typeof texto !== 'string') texto = String(texto);
            const temp = document.createElement('div');
            temp.textContent = texto;
            return temp.innerHTML;
        }

   function cargarEmailJS() {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
    script.onload = function() {
        try {
            window.emailjs.init('8SKjsqXHTpjoSMWRw');
            console.log("EmailJS inicializado.");
        } catch (e) {
            console.error("Error inicializando EmailJS:", e);
        }
    };
    script.onerror = function() {
        console.error("Error al cargar EmailJS.");
    };
    document.head.appendChild(script);
}

// Solo cargar si Firebase fue inicializado
if (typeof app !== 'undefined') {
    cargarEmailJS();
}

function enviarNotificacionEmail() {
    if (window.emailjs && typeof window.emailjs.send === 'function') {
        const serviceID = 'service_poil498';
        const templateID = 'template_wyew1g2';

        const templateParams = {
            message: 'Marcos: notification. Please, respond when you can',
            to_email: 'emailjsoras@gmail.com',
            date: new Date().toLocaleString()
        };

        window.emailjs.send(serviceID, templateID, templateParams)
            .then(function(response) {
                console.log("Notificaci√≥n enviada:", response.status, response.text);
            }, function(error) {
                console.error("Error al enviar la notificaci√≥n:", error);
            });
    } else {
        console.warn("EmailJS no est√° listo para enviar.");
    }
}


        function obtenerNombreUsuario(email) {
             if (!email || typeof email !== 'string') return "desconocido";
             return email.split('@')[0].toLowerCase();
        }

        function obtenerNombreMostrado(email) {
            const usuario = obtenerNombreUsuario(email);
            if (usuario === USUARIO_ESTRELLITA) return "Estrellita";
            if (usuario === USUARIO_ADMIN) return "Luna";
            return "Usuario";
        }

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
             // Solo resetear si auth est√° definido
             if (!auth) return;
            inactivityTimer = setTimeout(() => {
                if (auth.currentUser) {
                    console.log("Cerrando sesi√≥n por inactividad...");
                    registrarTiempoSesion(usuarioActual);
                    signOut(auth).then(() => {
                         alert("Sesi√≥n cerrada por inactividad.");
                    }).catch(error => {
                         console.error("Error al cerrar sesi√≥n por inactividad:", error);
                    });
                 }
            }, 15 * 60 * 1000); // 15 minutos de inactividad
        }

        // --- Registro de Accesos y Sesiones ---

        function registrarAcceso(usuario) {
             if (!usuario || !db || !auth || !auth.currentUser) return; // Verificar dependencias
             console.log(`Registrando acceso para ${usuario}`);
             try {
                 const accessLogRef = ref(db, `accesos/${usuario}`);
                 const now = new Date();
                 push(accessLogRef, {
                     timestamp: serverTimestamp(),
                     fechaLocal: now.toLocaleString(),
                     inicioEpoch: now.getTime()
                 });
                 loginTime = now.getTime();

                 // Enviar notificaci√≥n de acceso
                 enviarNotificacionEmail(nombreUsuarioLogueado, 'login');
             } catch (error) {
                  console.error("Error registrando acceso en DB:", error);
              }
         }

        function registrarTiempoSesion(usuario) {
             if (!usuario || loginTime === null || !db) return; // Verificar dependencias
             const sessionEndTime = new Date().getTime();
             const sessionDurationMillis = sessionEndTime - loginTime;
             const sessionDurationMinutes = (sessionDurationMillis / 1000 / 60).toFixed(2);

             console.log(`Registrando fin de sesi√≥n para ${usuario}. Duraci√≥n: ${sessionDurationMinutes} min`);
             try {
                 const sessionLogRef = ref(db, `tiempoSesiones/${usuario}`);
                 push(sessionLogRef, {
                     timestamp: serverTimestamp(),
                     fechaLocalInicio: new Date(loginTime).toLocaleString(),
                     fechaLocalFin: new Date(sessionEndTime).toLocaleString(),
                     duracionMinutos: parseFloat(sessionDurationMinutes),
                     inicioEpoch: loginTime,
                     finEpoch: sessionEndTime
                 });
                 loginTime = null;
             } catch (error) {
                  console.error("Error registrando tiempo de sesi√≥n en DB:", error);
              }
         }

        // --- L√≥gica de Emociones ---

         const listaEmociones = [
             { value: "feliz", label: "Feliz üòä" }, { value: "triste", label: "Triste üòî" },
             { value: "estresada", label: "Estresada üòµ‚Äçüí´" }, { value: "cansada", label: "Cansada ü•±" },
             { value: "extra√±andote", label: "Extra√±√°ndote ü•∫" }, { value: "pensandoEnTi", label: "Pensando en ti üí≠‚ù§Ô∏è" },
             { value: "conGanasDeVerte", label: "Con ganas de verte ü•∞" }, { value: "conGanasDePensar", label: "Con ganas de 'pensar' üòè" }
         ];

         function inicializarContadoresEmociones() {
             if (!db || !usuarioActual) return; // Verificar dependencias

             const contadoresRef = ref(db, "contadores");
             const historialEmocionesRef = ref(db, "historialEmociones");
             const usuario = usuarioActual;
             actualizarInfoAdmin(usuario);
             const contadorElement = document.getElementById("contador-emociones");
             const historialElement = document.getElementById("historial-emociones");

             // Reset listeners (o gestionarlos mejor si es necesario)
             // Aqu√≠ simplemente volvemos a a√±adirlos, onValue maneja esto bien generalmente.

             if (usuario === USUARIO_ADMIN) {
                 if (contadorElement) contadorElement.style.display = "block";
                 if (historialElement) historialElement.style.display = "block";
                  try {
                     onValue(contadoresRef, (snapshot) => {
                         actualizarUIContadores(snapshot.exists() ? snapshot.val() : {});
                     }, error => console.error("Error leyendo contadores:", error));
                     onValue(historialEmocionesRef, (snapshot) => {
                         actualizarUIHistorial(snapshot.exists() ? snapshot.val() : {});
                     }, error => console.error("Error leyendo historial:", error));
                 } catch(error) {
                     console.error("Error al a√±adir listeners de contadores/historial:", error);
                 }
             } else {
                 if (contadorElement) contadorElement.style.display = "none";
                 if (historialElement) historialElement.style.display = "none";
                 // Detener listeners si es necesario (aunque onValue deber√≠a manejarse bien)
             }
         }

         function actualizarInfoAdmin(usuario) {
             const adminInfoPanel = document.getElementById("admin-info");
             const usuarioNombreEl = document.getElementById("usuario-nombre");
             const adminStatusEl = document.getElementById("admin-status");
             if (adminInfoPanel && usuarioNombreEl && adminStatusEl) {
                 const esAdmin = (usuario === USUARIO_ADMIN);
                 adminInfoPanel.style.display = esAdmin ? "block" : "none";
                 if (esAdmin) {
                      usuarioNombreEl.textContent = usuario;
                      adminStatusEl.textContent = "S√≠";
                      adminStatusEl.style.color = "#2ecc71";
                 }
             }
         }

         function actualizarUIContadores(contadores) {
             const contenedor = document.getElementById("contadores-container");
             if (!contenedor) return;
             contenedor.innerHTML = "";
             listaEmociones.forEach(emocion => {
                 const contador = contadores[emocion.value] || 0;
                 const div = document.createElement("div");
                 div.className = "contador-item";
                 div.innerHTML = `<span class="contador-label">${sanitizarTexto(emocion.label)}:</span> <span class="contador-valor">${contador}</span>`;
                 contenedor.appendChild(div);
             });
         }

        function actualizarUIHistorial(historial) {
            const contenedor = document.getElementById("historial-container");
            if (!contenedor) return;
            contenedor.innerHTML = "";
            // A√±adir check por si historial no es un objeto (p.ej., null)
            if (!historial || typeof historial !== 'object') {
                 contenedor.innerHTML = "<p>A√∫n no hay historial de emociones.</p>";
                 return;
            }
            const historialArray = Object.entries(historial).map(([key, value]) => ({
                id: key, ...value,
                // Mejorar el c√°lculo del timestampEpoch
                timestampEpoch: value?.timestampEpoch || (typeof value?.timestamp === 'number' ? value.timestamp : new Date(value?.fechaLocal || 0).getTime()) || Date.now()
            }));
            historialArray.sort((a, b) => b.timestampEpoch - a.timestampEpoch);
            if (historialArray.length === 0) {
                 contenedor.innerHTML = "<p>A√∫n no hay historial de emociones.</p>"; return;
            }
            historialArray.forEach(evento => {
                const emocionData = listaEmociones.find(e => e.value === evento.emocion);
                const nombreEmocion = emocionData ? emocionData.label : evento.emocion;
                const fechaFormateada = evento.fechaLocal || new Date(evento.timestampEpoch).toLocaleString();
                const div = document.createElement("div");
                div.className = "historial-item";
                div.innerHTML = `<span>${sanitizarTexto(nombreEmocion)}</span> <span style="float: right; font-style: italic; font-size: 0.9em;">${sanitizarTexto(fechaFormateada)}</span>`;
                contenedor.appendChild(div);
            });
        }

        window.incrementarContadorEmocion = function(emocion) {
            // Verificar dependencias
            if (!auth || !auth.currentUser || !db || usuarioActual !== USUARIO_ESTRELLITA) {
                 console.log(`Usuario ${usuarioActual} (${nombreUsuarioLogueado}) no es Estrellita o Firebase no est√° listo, no se registra emoci√≥n.`);
                 return;
             }

             console.log(`Registrando emoci√≥n: ${emocion} para ${usuarioActual}`);
             try {
                 // 1. Incrementar contador
                 const contadorRef = ref(db, `contadores/${emocion}`);
                 get(contadorRef).then((snapshot) => set(contadorRef, (snapshot.exists() ? snapshot.val() : 0) + 1));

                 // 2. A√±adir historial
                 const historialEmocionesRef = ref(db, "historialEmociones");
                 const now = new Date();
                 push(historialEmocionesRef, {
                     emocion: emocion, usuario: usuarioActual, timestamp: serverTimestamp(),
                     fechaLocal: now.toLocaleString(), timestampEpoch: now.getTime()
                 }).then(() => {
                     const emocionLabel = listaEmociones.find(e => e.value === emocion)?.label || emocion;
                  
                 });
             } catch (error) {
                  console.error("Error al registrar emoci√≥n en DB:", error);
              }
        };

        // --- L√≥gica del Chat Secreto ---

        function mostrarMensajeChatSecreto(data) {
            if (!data || (data.key && mensajesMostrados.has(data.key))) return;
            const chat = document.getElementById("chat");
            if (!chat) return;
            const mensajeElemento = document.createElement("div");
            mensajeElemento.classList.add("mensaje-secreto");
            // Verificar auth.currentUser antes de usarlo
            const esMio = auth && auth.currentUser && data.usuario === obtenerNombreMostrado(auth.currentUser.email);
            mensajeElemento.classList.add(esMio ? "mio" : "otro");
            if (data.key) mensajesMostrados.add(data.key);
            const nombreMostrado = sanitizarTexto(data.usuario || "Usuario");
            const mensajeSanitizado = sanitizarTexto(data.mensaje);
            const mensajeFormateado = mensajeSanitizado.replace(/\n/g, '<br>');
            mensajeElemento.innerHTML = `<strong>${nombreMostrado}</strong>${mensajeFormateado}`;
            chat.appendChild(mensajeElemento);
            // Asegurar scroll al final
            requestAnimationFrame(() => { // Esperar al siguiente frame para asegurar renderizado
                 chat.scrollTop = chat.scrollHeight;
            });
        }

function cargarMensajesIniciales() {
    if (!db) return;
    const mensajesRef = ref(db, "mensajes");
    mensajesMostrados.clear();
    const chat = document.getElementById("chat");
    if (!chat) return;
    chat.innerHTML = "";
    console.log("Cargando mensajes iniciales...");
    const mensajesQuery = query(mensajesRef, orderByChild('timestamp'), limitToLast(50));
    try {
        get(mensajesQuery).then((snapshot) => {
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    mostrarMensajeChatSecreto({ key: childSnapshot.key, ...childSnapshot.val() });
                });
                // Asegurar scroll al final con verificaci√≥n repetitiva
                let intentos = 0;
                const maxIntentos = 10; // L√≠mite para evitar bucles infinitos
                const intervaloScroll = setInterval(() => {
                    chat.scrollTop = chat.scrollHeight;
                    // Verificar si el scroll est√° realmente al final
                    if (chat.scrollTop + chat.clientHeight >= chat.scrollHeight - 1 || intentos >= maxIntentos) {
                        clearInterval(intervaloScroll);
                        console.log("Scroll ajustado a los √∫ltimos mensajes iniciales despu√©s de", intentos, "intentos.");
                    }
                    intentos++;
                }, 100); // Revisar cada 100ms
            } else {
                chat.innerHTML = "<p style='text-align:center; opacity:0.7;'>Inicia la conversaci√≥n...</p>";
            }
        }).catch(error => console.error("Error en get() de mensajes iniciales:", error));
    } catch (error) {
        console.error("Error al configurar query/get de mensajes iniciales:", error);
    }
}

        let childAddedListener = null; // Para poder removerlo si es necesario

        function inicializarReceptorMensajes() {
             if (!db) return; // Verificar dependencia

             // Detener listener anterior si existe (para evitar duplicados al re-loguear)
             // Esto requiere una referencia m√°s compleja a la query, no solo al ref.
             // Por ahora, confiamos en el chequeo de mensajesMostrados.
             // if (childAddedListener) {
             //    off(mensajesRef, 'child_added', childAddedListener); // Necesita la referencia exacta
             // }

            const mensajesRef = ref(db, "mensajes");
             console.log("Inicializando listener para nuevos mensajes...");
             try {
                 // Usar una query m√°s reciente para el listener si es posible
                 const mensajesNuevosQuery = query(mensajesRef, orderByChild('timestamp'), limitToLast(1)); // Opcional: escuchar solo el √∫ltimo

                 childAddedListener = onChildAdded(mensajesRef, (snapshot) => { // Escuchar en la referencia base sigue siendo com√∫n
                     const data = snapshot.val(); const key = snapshot.key;
                     if (key && data && !mensajesMostrados.has(key)) {
                          mostrarMensajeChatSecreto({ key, ...data });
                          if (document.hidden && auth && auth.currentUser && data.usuario !== obtenerNombreMostrado(auth.currentUser.email)) {
                              console.log("Nuevo mensaje recibido mientras la pesta√±a estaba inactiva.");
                          }
                      }
                 });
             } catch (error) {
                  console.error("Error al a√±adir listener onChildAdded:", error);
              }
        }

        if (enviarBtnSecreto && inputSecreto) {
            enviarBtnSecreto.addEventListener("click", function () {
                if (!auth || !auth.currentUser || !db) { // Verificar dependencias
                    console.error("Firebase no listo o usuario no autenticado, no se puede enviar mensaje.");
                    return;
                 }
                const user = auth.currentUser;
                const mensajesRef = ref(db, "mensajes");
                const mensajeTexto = inputSecreto.value.trim();
                if (mensajeTexto) {
                    const nombreParaMostrar = obtenerNombreMostrado(user.email);
                    const nuevoMensaje = {
                        usuario: nombreParaMostrar, mensaje: mensajeTexto,
                        fechaLocal: new Date().toLocaleString(), timestamp: serverTimestamp()
                    };
                    inputSecreto.value = ""; inputSecreto.style.height = 'auto';
                     try {
                         push(mensajesRef, nuevoMensaje)
                             .then(() => {
                                 console.log("Mensaje enviado a Firebase.");
                             
                             })
                             .catch((error) => console.error("Error en push() de mensaje:", error));
                     } catch (error) {
                          console.error("Error al configurar push() de mensaje:", error);
                      }
                    resetInactivityTimer();
                }
            });
            inputSecreto.addEventListener("keydown", function(event) {
                 if (event.key === "Enter" && !event.shiftKey) {
                     event.preventDefault(); enviarBtnSecreto.click();
                 }
                 setTimeout(() => { inputSecreto.style.height = 'auto'; inputSecreto.style.height = inputSecreto.scrollHeight + 'px'; }, 0);
            });
         }


        // --- Autenticaci√≥n y Estado del Usuario ---

        // Solo a√±adir listeners si los botones existen y Firebase auth est√° listo
        if (loginButton && auth) {
            loginButton.addEventListener("click", () => {
                if (!auth) { console.error("Auth no inicializado."); return; } // Chequeo extra

                const email = emailInputLogin ? emailInputLogin.value : '';
                const password = passwordInputLogin ? passwordInputLogin.value : '';

                if (loginError) {
                    loginError.textContent = "";
                    loginError.style.display = "none";
                }

                if (!email || !password) {
                     if (loginError) {
                        loginError.textContent = "Por favor, ingresa correo y contrase√±a.";
                        loginError.style.display = "block";
                    }
                     return;
                 }
		// Cuando el usuario haga clic en el bot√≥n de login, enviamos la notificaci√≥n

		document.getElementById("login").addEventListener("click", () => {
    			enviarNotificacionEmail(); // üîî Aqu√≠ se activa el env√≠o del correo
});

                console.log("Intentando iniciar sesi√≥n con:", email);
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        console.log("Inicio de sesi√≥n en proceso para:", userCredential.user.email);
                    })
                    .catch((error) => {
                        console.error("Error al iniciar sesi√≥n:", error.code, error.message);
                        if (loginError) {
                            switch(error.code) {
                                case 'auth/invalid-email': loginError.textContent = "El formato del correo no es v√°lido."; break;
                                case 'auth/user-not-found':
                                case 'auth/wrong-password':
                                case 'auth/invalid-credential': loginError.textContent = "Correo o contrase√±a incorrectos."; break;
                                case 'auth/too-many-requests': loginError.textContent = "Demasiados intentos fallidos. Intenta m√°s tarde."; break;
                                default: loginError.textContent = "Error al iniciar sesi√≥n. Verifica tus datos o la conexi√≥n.";
                            }
                            loginError.style.display = "block";
                        }
                    });
            });
        } else if (!auth) {
             console.warn("Bot√≥n de login encontrado pero Auth no est√° inicializado.");
         }

        if (logoutButton && auth) {
            logoutButton.addEventListener("click", () => {
    const seccionSecreta = document.getElementById("seccion-secreta");
    if (seccionSecreta) seccionSecreta.style.display = "none";
    const loginContainer = document.getElementById("loginContainer");
    if (loginContainer) loginContainer.style.display = "block";

                 if (!auth) { console.error("Auth no inicializado."); return; } // Chequeo extra
                console.log("Cerrando sesi√≥n...");
                registrarTiempoSesion(usuarioActual);
                signOut(auth).catch((error) => {
                    console.error("Error al cerrar sesi√≥n:", error);
                    alert("Error al cerrar sesi√≥n: " + error.message);
                });
            });
         } else if (!auth) {
             console.warn("Bot√≥n de logout encontrado pero Auth no est√° inicializado.");
         }

        // Manejador central del estado de autenticaci√≥n
        // Solo a√±adir si auth est√° listo
if (auth) {
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("Usuario autenticado:", user.email);
            usuarioActual = obtenerNombreUsuario(user.email);
            nombreUsuarioLogueado = obtenerNombreMostrado(user.email);
            window.nombreUsuarioLogueado = nombreUsuarioLogueado;

            if (loginContainer) loginContainer.style.display = "none";
            if (contenidoSecreto) {
                contenidoSecreto.style.display = "block";
                // Asegurar que el chat est√© visible y desplazado al final
                const chat = document.getElementById("chat");
                if (chat) {
                    // Forzar recalculo de dimensiones al mostrar el contenedor
                    chat.style.display = "flex"; // Asegurar que el flex se aplique
                    setTimeout(() => {
                        chat.scrollTop = chat.scrollHeight;
                        console.log("Chat desplazado al √∫ltimo mensaje al mostrar contenido secreto.");
                    }, 200); // Retraso para esperar renderizado completo
                }
            }
            if (loginError) loginError.style.display = 'none';

            registrarAcceso(usuarioActual);
            inicializarContadoresEmociones();
            cargarMensajesIniciales();
            inicializarReceptorMensajes();

            resetInactivityTimer();
            document.addEventListener("mousemove", resetInactivityTimer);
            document.addEventListener("keydown", resetInactivityTimer);
        } else {
            // Usuario est√° deslogueado
            console.log("Usuario no autenticado.");
            usuarioActual = "";
            nombreUsuarioLogueado = "";
            window.nombreUsuarioLogueado = "";

            if (loginContainer) loginContainer.style.display = "block";
            if (contenidoSecreto) contenidoSecreto.style.display = "none";

            clearTimeout(inactivityTimer);
            document.removeEventListener("mousemove", resetInactivityTimer);
            document.removeEventListener("keydown", resetInactivityTimer);
            mensajesMostrados.clear();
            const chat = document.getElementById("chat");
            if (chat) chat.innerHTML = "";

            if (emailInputLogin) emailInputLogin.value = '';
            if (passwordInputLogin) passwordInputLogin.value = '';
            if (loginError) {
                loginError.textContent = '';
                loginError.style.display = 'none';
            }
        }
    });
}
 
else {
             console.error("Auth no est√° disponible, no se puede a√±adir el listener onAuthStateChanged.");
             // Informar al usuario o manejar el error de UI
             if (loginContainer) loginContainer.innerHTML = "<h2>Error</h2><p>No se pudo conectar al servicio de autenticaci√≥n.</p>";
        }


        // --- Otras Inicializaciones ---
        window.addEventListener('beforeunload', () => {
             // Solo registrar si Firebase est√° listo y hay usuario
             if (db && auth && auth.currentUser && usuarioActual && loginTime) {
                 registrarTiempoSesion(usuarioActual);
             }
        });

        // DOMContentLoaded ya se dispar√≥ probablemente, pero podemos poner logs finales aqu√≠
         console.log("Script modular finalizado.");
         if (!app) {
            console.error("Firebase App no se inicializ√≥ correctamente al final del script.");
        }


        // (Opcional: Funci√≥n inicializarEstadoConexion)
        function inicializarEstadoConexion() {
            // A√±adir chequeos de dependencias
            if (!auth || !auth.currentUser || !db) return;
            const currentUserEmail = auth.currentUser.email;
            const currentUserShortName = obtenerNombreUsuario(currentUserEmail);
            const nombreMostradoLocal = obtenerNombreMostrado(currentUserEmail);

            if (currentUserShortName === USUARIO_ESTRELLITA || currentUserShortName === USUARIO_ADMIN) {
                 try {
                     const userStatusRef = ref(db, `estadoUsuarios/${nombreMostradoLocal}`);
                     const presenceRef = ref(db, '.info/connected');

                     onValue(presenceRef, (snap) => {
                         if (!auth.currentUser) return;
                         if (snap.val() === true) {
                             set(userStatusRef, { online: true, last_changed: serverTimestamp() });
                             onDisconnect(userStatusRef).set({ online: false, last_changed: serverTimestamp() });
                             console.log(`${nombreMostradoLocal} est√° conectado.`);
                         } else {
                             console.log(`${nombreMostradoLocal} est√° desconectado (o conectando).`);
                         }
                     });

                     const otroUsuarioNombre = nombreMostradoLocal === "Estrellita" ? "Luna" : "Estrellita";
                     const otroUsuarioStatusRef = ref(db, `estadoUsuarios/${otroUsuarioNombre}`);
                     onValue(otroUsuarioStatusRef, (snapshot) => {
                         if (snapshot.exists()) {
                             const estadoOtro = snapshot.val();
                             console.log(`Estado de ${otroUsuarioNombre}: ${estadoOtro.online ? 'Conectado' : 'Desconectado'}`);
                         }
                     });
                 } catch (error) {
                      console.error("Error inicializando estado de conexi√≥n:", error);
                  }
            }
        }

// PEGA TODO ESTE BLOQUE AL FINAL DE TU SCRIPT DE TIPO MODULE

const borrarChatBtn = document.getElementById('borrarChatBtn');

// L√≥gica principal de borrado y visibilidad
if (borrarChatBtn && db && auth) {

    // 1. A√±adimos el listener para la acci√≥n de borrado
    borrarChatBtn.addEventListener('click', () => {
        // Pedimos una doble confirmaci√≥n, ya que es una acci√≥n irreversible
        const confirmacion = confirm("¬øEst√°s MUY segura de que quieres borrar TODOS los mensajes del chat?\n\nEsta acci√≥n es permanente y no se puede deshacer.");

        if (confirmacion) {
            console.log("El administrador confirm√≥ el borrado. Eliminando mensajes...");
            const mensajesRef = ref(db, 'mensajes');

            // Usamos la funci√≥n remove() para borrar todo el nodo 'mensajes' de Firebase
            remove(mensajesRef)
                .then(() => {
                    console.log("Todos los mensajes han sido eliminados de Firebase.");
                    alert("El chat ha sido limpiado con √©xito.");

                    // Limpiamos la interfaz de usuario para que refleje el cambio
                    const chat = document.getElementById("chat");
                    if (chat) {
                        chat.innerHTML = "<p style='text-align:center; opacity:0.7;'>El chat ha sido limpiado por un administrador.</p>";
                    }
                    
                    // Reseteamos el set de mensajes mostrados para evitar problemas
                    mensajesMostrados.clear();
                })
                .catch((error) => {
                    console.error("Error al borrar los mensajes:", error);
                    alert("Ocurri√≥ un error al intentar limpiar el chat. Revisa la consola (F12).");
                });
        } else {
            console.log("El administrador cancel√≥ la operaci√≥n de borrado.");
        }
    });

    // 2. Controlamos la visibilidad del bot√≥n seg√∫n el usuario logueado
    onAuthStateChanged(auth, (user) => {
        if (user && borrarChatBtn) {
            const usuario = obtenerNombreUsuario(user.email);
            // El bot√≥n solo ser√° visible si el usuario es el administrador
            if (usuario === USUARIO_ADMIN) {
                borrarChatBtn.style.display = 'inline-block';
            } else {
                borrarChatBtn.style.display = 'none';
            }
        } else if (borrarChatBtn) {
            // Si no hay usuario, el bot√≥n debe estar oculto
            borrarChatBtn.style.display = 'none';
        }
    });
}
// FIN DEL BLOQUE PARA PEGAR

</script>
</body>
</html>
